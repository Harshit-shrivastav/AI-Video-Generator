<!DOCTYPE html>
<html>
<head>
   <title>Video Generation</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
   <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
   <style>
       /* Additional custom styles */
       body {
           background-color: #f8f9fa;
       }
       .container {
           max-width: 600px;
       }
       .progress-container {
           display: none;
       }
       .btn-success {
           width: 100%;
       }
       @media (min-width: 768px) {
           .container {
               max-width: 700px;
           }
       }
       @media (min-width: 992px) {
           .container {
               max-width: 900px;
           }
       }
   </style>
</head>
<body>
   <div class="container mt-5">
       <h1 class="text-center">Generate Video</h1>
       <form id="generate-form">
           <div class="form-group">
               <label for="title" class="form-label">Title</label>
               <input type="text" class="form-control" id="title" name="title" required>
           </div>
           <div class="form-group">
               <label for="speaker" class="form-label">Speaker</label>
               <select class="form-control" id="speaker" name="speaker" required>
                   <option value="en-US-AnaNeural">Ana - English-US</option>
                   <option value="en-US-ChristopherNeural">Christopher - English-US</option>
                   <option value="en-US-EricNeural">Eric - English-US</option>
                   <option value="en-US-GuyNeural">Guy - English-US</option>
                   <option value="en-US-JennyNeural">Jenny - English-US</option>
                   <option value="en-US-MichelleNeural">Michelle - English-US</option>
                   <option value="en-IN-NeerjaNeural">Neerja - English-IN</option>
                   <option value="en-IN-PrabhatNeural">Prabhat - English-IN</option>
                   <option value="hi-IN-MadhurNeural">Madhur - Hindi-IN</option>
                   <option value="hi-IN-SwaraNeural">Swara - Hindi-IN</option>
               </select>
           </div>
           <button type="submit" class="btn btn-primary btn-block">Generate</button>
       </form>
       <div id="progress-container" class="progress-container mt-3">
           <div class="progress">
               <div id="progress-bar" class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%;"></div>
           </div>
           <p id="progress-text" class="mt-2 text-center">Generating video, please wait...</p>
       </div>
       <a id="download-link" href="#" class="btn btn-success mt-3" style="display:none;">Download Video</a>
   </div>

   <script>
       $(document).ready(function() {
           $('#generate-form').submit(function(event) {
               event.preventDefault();
               $('#download-link').hide();
               $('#progress-container').show();
               $('#progress-bar').css('width', '50%'); // Set progress to 50% just after tapping generate button
               $('#progress-text').text('Generating video, please wait...');
               
               var formData = new FormData(this);

               $.ajax({
                   url: '/generate',
                   type: 'POST',
                   data: formData,
                   processData: false,
                   contentType: false,
                   success: function(response) {
                       if (response.step === 'final_video_merged') {
                           $('#progress-bar').css('width', '80%');
                           $('#progress-text').text('Final video merging completed...');
                       } else if (response.step === 'video_ready') {
                           if (response.video_path) {
                               setTimeout(() => {
                                   $('#progress-bar').css('width', '100%');
                                   setTimeout(() => {
                                       $('#progress-container').hide();
                                       $('#download-link').attr('href', response.video_path).show();
                                   }, 2000);
                               }, 0);
                           } else {
                               alert('Error: Server did not provide a valid video path.');
                           }
                       } else {
                           alert('Error: Unexpected response from server.');
                       }
                   },
                   error: function(xhr, status, error) {
                       alert('Error: ' + xhr.responseText);
                       console.error('AJAX error:', error);
                   }
               });
           });
       });
   </script>
</body>
</html>
